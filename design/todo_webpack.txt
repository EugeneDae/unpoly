- Module build
- Also compile and minify CSS
- Remove redundant sprockets requires (we now import it all in unpoly.js)


- Style Pipeline for production files

- Use https://www.npmjs.com/package/webpack-preprocessor-loader instead of ERB so we keep valid JS files


spec/index.html -- lÃ¤dt den runner


development:
  dist/specs.js
    JS spec helpers


  dist/unpoly.development.es5.js
    transpilet
    nicht minimized
    mit Knifes

  dist/unpoly.development.esnext.js
    ES6
    nicht minified
    mit Knifes

production:
  dist/unpoly.es5.js
  dist/unpoly.es5.min.js
  dist/unpoly.esnext.js
  dist/unpoly.esnext.min.js


- upgrade to node 14 (lts/fermium)
- upgrade typescript



Final folder structure
======================

- Webpack should WATCH instead of boot a dev server!
- Or be both with writeToDisk: true
- Maybe have a separate watch task
- Maybe don't have separate development and build configs



Why compile down to ES5?
========================
Every app has an ES5 pipeline.

=> But Sprockets / Uglifier cannot do destructiring, even with harmony: true


unpoly.js // in .gitignore
unpoly.min.js
unpoly.dev.es5.js
unpoly.dev.esnext.js

Build everything all the time!



Structure
=========


/unpoly
  Rakefile // publish scripts are still here, eventually move to package.json; Must update VERSION in package.json or throw if differs

  package.json // must rename contents from dist/ to build/

  VERSION

  build/
    <output folder for webpack>
    specs.html -> ../test/specs.html
    unpoly.js              // in .gitignore
    unpoly.min.js          // in .gitignore
    unpoly.es5.js              // in .gitignore
    unpoly.es5.min.js              // in .gitignore

    unpoly.dev.es5.js      // in .gitignore
    unpoly.dev.js          // in .gitignore

    specs.js               // in .gitignore
    jasmine.js             // in .gitignore

    unpoly-bootstrap3.js       // in .gitignore
    unpoly-bootstrap3.min.js   // in .gitignore
    unpoly-bootstrap3.css      // in .gitignore
    unpoly-bootstrap3.min.css  // in .gitignore
    ...
    unpoly-migrate.js          // in .gitignore

  src/
    unpoly.js
    unpoly-bootstrap3.js
    unpoly-bootstrap4.js
    unpoly-bootstrap5.js
    unpoly-migrate.js
    not needed anymore: unpoly.css (manifest is in pack.js)

    unpoly/
      fragment.coffee
      fragment.sass
      protocol.coffee
      form.coffee
      form.sass

  test/
    helpers/
      to_match_url.coffee
      to_have_text.coffee
    unpoly/
      fragment_spec.coffee
      protocol_spec.coffee
    jasmine.js
    specs.js
    specs.css
    specs.html


/unpoly-rails

  unpoly-rails.gemspec

  lib/
    unpoly-rails.rb
    unpoly/
      rails/
        engine.rb
        ...
    assets/
      javascripts/
        unpoly.js  -> ../../../unpoly/build/unpoly.js   # must be copied into gem!
      stylesheets/
        unpoly.css -> ../../../unpoly/build/unpoly.css   # must be copied into gem!

  Rakefile
    release-task kopiert assets und macht version.rb aus package.json


/unpoly-manual-test
  app/...

  Gemfile uses unpoly-rails from ../unpoly-rails


/unpoly-site
  app/...

  vendor
    unpoly-local
      unpoly.js  -> ../../../unpoly/build/unpoly.js
      unpoly.css -> ../../../unpoly/build/unpoly.css
